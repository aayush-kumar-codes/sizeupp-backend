{% extends 'back-end/template.html' %}
{% block content %}

            <!-- index body start -->
            <div class="page-body">
                <div class="container-fluid">
                    <div class="row">
                        <!-- chart caard section start -->
                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 border-0  card-hover card o-hidden">
                                <div class="custome-1-bg b-r-4 card-body">
                                    <div class="media align-items-center static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Revenue</span>
                                            <h4 class="mb-0 counter">â‚¹{{revenue}}
                                             
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-database-2-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-2-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0"> Orders Processing</span>
                                            <h4 class="mb-0 counter">{{order_processing}}
                                               
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-shopping-bag-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-4-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Return Orders</span>
                                            <h4 class="mb-0 counter">{{order_cancel}}
                                             
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-shopping-bag-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0  card o-hidden">
                                <div class="custome-3-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Products</span>
                                            <h4 class="mb-0 counter">{{products|length}}
                                                <a href="{% url 'addproduct' %}?status=add" class="badge badge-light-secondary grow">
                                                    ADD NEW</a>
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-chat-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        

                     


                        <!-- Earning chart star-->
                        <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Revenue Report</h4>
                                    </div>
                                </div>
                                <div class="container d-flex">
                                    <a onclick="fetchAndDrawChart('daily')" class="btn btn-primary m-2">Daily</a>
                                    <a onclick="fetchAndDrawChart('week')" class="btn btn-primary m-2">Weekly</a>
                                    <a onclick="fetchAndDrawChart('month')" class="btn btn-primary m-2">Monthly</a>
                                </div>
                                <div class="card-body p-0">
                                    <div id="report">
                                        <canvas id="myChart" style="width:100%;max-width:"></canvas>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Order Distribution by State</h4>
                                    </div>
                                </div>
                                
                                <div class="card-body p-0">
                                    <div id="piechart">
                                        {% comment %} <canvas id="myChart" style="width:100%;max-width:"></canvas> {% endcomment %}
                                        <canvas id="orderStatePieChart" width="400" height="400"></canvas>

                                    </div>
                                </div>
                            </div>
                        </div>

    

                        <!-- Earning chart  end-->


                        {% comment %} <!-- Best Selling Product Start -->
                        <div class="col-xl-6 col-md-12">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Best Selling Product</h4>
                                    </div>

                                    <div class="best-selling-box d-sm-flex d-none">
                                      
                                    </div>
                                </div>

                                <div class="card-body p-0">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="best-selling-table w-image
                                            w-image
                                            w-image table border-0">
                                                <tbody>
                                                    {% for i  in top_selling_products_list %}
                                                    
                                                    <tr>
                                                        <td>
                                                            <div class="best-product-box">
                                                                <div class="product-image">
                                                                    <img src="../../media/{{i.product.img}}"
                                                                        class="img-fluid" alt="Product">
                                                                </div>
                                                                <div class="product-name">
                                                                    <h5>{{i.product.name}}</h5>
                                                                </div>
                                                            </div>
                                                        </td>

                                                     

                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Orders</h6>
                                                                <h5>{{i.orders}}</h5>
                                                            </div>
                                                        </td>

                                                       
                                                    </tr>

                                                    {% endfor %}

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Best Selling Product End --> {% endcomment %}


                        <!-- Recent orders start-->
                        <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Recent Orders</h4>
                                    </div>

                                   
                                </div>

                                <div class="card-body p-0">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="best-selling-table table border-0">
                                                <tbody>
                                                    {% for order in orders %}
                                                    
                                                    <tr>
                                                        <td>
                                                            <div class="best-product-box">
                                                                <div class="product-name">
                                                                    <h5>Order Id:</h5>
                                                                    <a href="{% url 'order_details' order.id %}">#{{order.id}}</a>
                                                                </div>
                                                            </div>
                                                        </td>

                                                        <td>

                                                            <div class="product-detail-box">
                                                                <h6>Delivery Status</h6>
                                                                <h5>{{order.delivery_status}}</h5>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Date Placed</h6>
                                                                <h5>{{order.created_at}}</h5>
                                                            </div>
                                                        </td>

                                                        <td>

                                                            <div class="product-detail-box">
                                                                <h6>Price</h6>
                                                                <h5>â‚¹{{order.payment_amount}}</h5>
                                                            </div>
                                                        </td>

                                                        

                                                        <td>
                                                            <div class="product-detail-box">
                                                                <h6>Payment Type</h6>
                                                                <h5>{{order.payment_type}}</h5>
                                                                {% comment %} {% if order.payment_status == 'Completed' %}
                                                                <h5 class="text-success">Paid</h5>

                                                                {% else %}
                                                                <h5 class="text-danger">Unpaid</h5>
                                                                {% endif %} {% endcomment %}
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    {% endfor %}


                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Recent orders end-->

                        <!-- Earning chart star-->
                        {% comment %} <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0 mb-0">
                                    <div class="card-header-title">
                                        <h4>Earning</h4>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="bar-chart-earning"></div>
                                </div>
                            </div>
                        </div> {% endcomment %}
                        <!-- Earning chart end-->


                     

                        {% comment %} <!-- visitors chart start-->
                        <div class="col-xxl-4 col-md-6">
                            <div class="h-100">
                                <div class="card o-hidden card-hover">
                                    <div class="card-header border-0">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="card-header-title">
                                                <h4>Visitors</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="pie-chart">
                                            <div id="pie-chart-visitors"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- visitors chart end--> {% endcomment %}


                        <!-- To Do List start-->
                        <div class="col-xxl-4 col-md-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0">
                                    <div class="card-header-title">
                                        <h4>To Do List</h4>
                                    </div>
                                </div>

                                <div class="card-body pt-0">
                                    <ul class="to-do-list">
                                        {% for i  in todolist %}
                                        <li class="to-do-item ">
                                                <form class="row g-2 w-100" >
                                                <div class="form-check user-checkbox col-2">
                                                
                                                    <input class="checkbox_animated check-it" type="checkbox" value=""
                                                    id="flexCheckDefault">
                                                    <input type="hidden" id="hiddenid" value="{{i.id}}">

                                                </div>
                                                <div class="to-do-list-name col-8">
                                                    <strong>{{i.name}}</strong>
                                                </div>
                                            </form>
                                            </li>
                                        {% endfor %}

                                        <li class="to-do-item">
                                            <form class="row g-2" action="{% url 'todoList_crud' %}" method="POST">
                                                    {% csrf_token %}
                                                <div class="col-8">
                                                    <input type="text" class="form-control" id="name" name="name"
                                                        placeholder="Enter Task Name">
                                                </div>
                                                <div class="col-4">
                                                    <button type="submit" class="btn btn-primary w-100 h-100">Add
                                                        task</button>
                                                </div>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- To Do List end-->


                    </div>
                    
                </div>
                <!-- Container-fluid Ends-->

                <!-- footer start-->
                 
                <!-- footer End-->
            </div>
            <!-- index body end -->

        <script>
                // Get all the checkboxes with the class "check-it"
            const checkboxes = document.querySelectorAll('.check-it');

            // Attach a click event listener to each checkbox
            checkboxes.forEach(checkbox => {
            checkbox.addEventListener('click', function() {
                // Check if the checkbox is checked
                if (this.checked) {
                // Define the URL to navigate to
                const id = document.getElementById('hiddenid').value;
                const url = `/todolist?CHECKED=TRUE&id=${id}`;

                // Navigate to the URL
                window.location.href = url;
                }
            });
            });
        </script>
        
    
        <script>
            function fetchAndDrawChart(interval) {
                console.log(`Fetching data for ${interval}`);
                fetch(`/revenue-data?interval=${interval}`)
                    .then(response => response.json())
                    .then(data => {
                        const xValues = data.map(item => Object.keys(item)[0]);
                        const yValues = data.map(item => Object.values(item)[0]);
                        console.log(xValues, yValues);
                        drawChart(xValues, yValues, interval);
                    })
                    .catch(error => {
                        console.error("Error fetching revenue data:", error);
                    });
            }
        
            function drawChart(xValues, yValues, interval) {
                const xLabels = interval === 'daily' ? xValues : [];
                new Chart("myChart", {
                    type: "line",
                    data: {
                        labels: xLabels,
                        datasets: [
                            {
                                label: "Revenue",
                                fill: true,
                                lineTension: 0,
                                backgroundColor: "#b45665",
                                borderColor: "#5e131f",
                                data: yValues
                            }
                        ]
                    },
                    options: {
                        legend: { display: false },
                        scales: {
                            yAxes: [{ ticks: { min: 0, max: 100 } }],
                            xAxes: [{
                                type: 'time',
                                time: {
                                    unit: 'day',
                                    tooltipFormat: 'MMM D',
                                    displayFormats: {
                                        day: 'MMM D'
                                    }
                                },
                                display: interval === 'daily'
                            }]
                        }
                    }
                });
            }
        </script>
        

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const orderStatesData = {{ order_states|safe }};
                const totalOrders = orderStatesData.reduce((total, item) => total + item.order_count, 0);
                const labels = orderStatesData.map(item => `${item.state} (${item.order_count} orders)`);
                const data = orderStatesData.map(item => item.order_count);
        
                const ctx = document.getElementById('orderStatePieChart').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: [
                                '#FF6384',
                                '#36A2EB',
                                '#FFCE56',
                                // Add more colors as needed
                            ],
                        }],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        tooltips: {
                            callbacks: {
                                label: function (tooltipItem, data) {
                                    return data.labels[tooltipItem.index];
                                },
                            },
                        },
                        title: {
                            display: true,
                            text: `Total Orders: ${totalOrders}`,
                            fontSize: 16,
                        },
                    },
                });
            });
        </script>
        
        
        

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
                
            {% endblock content %}
       